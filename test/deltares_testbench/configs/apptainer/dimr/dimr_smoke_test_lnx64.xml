<?xml version="1.0" encoding="iso-8859-1"?>
<deltaresTestbench_v3 xmlns="http://schemas.deltares.nl/deltaresTestbench_v3"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:xi="http://www.w3.org/2001/XInclude" xsi:schemaLocation="http://schemas.deltares.nl/deltaresTestbench_v3 http://content.oss.deltares.nl/schemas/deltaresTestbench_v3-2.00.xsd">

	<config>
		<localPaths>
			<testCasesDir>./data/cases</testCasesDir>
			<enginesDir>./data/engines</enginesDir>
			<referenceDir>./data/reference_results</referenceDir>
		</localPaths>
		<locations>
			<location name="cases">
				<credential ref="commandline"/>
				<root>{server_base_url}/cases</root>
			</location>
			<location name="reference_results">
				<credential ref="commandline"/>
				<root>{server_base_url}/references</root>
			</location>
			<location name="reference_engines">
				<credential ref="commandline"/>
				<root>{server_base_url}/references/bin</root>
			</location>
			<location name="local">
				<root>./data/engines</root>
			</location>
		</locations>
	</config>

	<programs>
		<program name="dimr" logOutputToFile="true" programStringRemoveQuotes="true">
			<location ref="local" type="check">
				<from>teamcity_artifacts</from>
			</location>
			<path>execute_singularity_tc.sh</path>
			<environments>
				<environment name="OMP_NUM_THREADS" type="raw">1</environment>
				<environment name="PROC_DEF_DIR" type="path">[programpath(dimr)]/../share/delft3d</environment>
			</environments>
			<arguments>
				<argument>-p</argument>
				<argument>2</argument>
				<argument>run_dimr.sh</argument>
				<argument>-m dimr.xml</argument>
			</arguments>
		</program>
		<program name="execute_container" logOutputToFile="true" programStringRemoveQuotes="true">
			<location ref="local" type="check">
				<from>teamcity_artifacts</from>				<!-- just the first part of the directory structure, will be filled by TeamCity -->
			</location>
			<path>execute_singularity_tc.sh</path>
			<environments>
				<environment name="OMP_NUM_THREADS" type="raw">1</environment>
			</environments>
			<arguments>
				<argument>-p</argument>
				<argument>2</argument>
			</arguments>
		</program>
	</programs>

	<defaultTestCases>
		<testCase name="dimr_trunk">
            <programs>
                <program ref="execute_singularity">
                    <arguments>
                        <argument>-p</argument>
                        <argument>2</argument>
                        <argument>run_dimr.sh</argument>
                        <argument>-m</argument>
                        <argument>dimr_config.xml</argument>
                    </arguments>
                </program>
            </programs>
            <location ref="reference_results" type="reference">
                <from>lnx64</from>
            </location>
            <location ref="cases" type="input">
                <from>.</from>
            </location>
            <maxRunTime>6000.0</maxRunTime> <!-- seconds -->
        </testCase>
		<testCase name="dimr_trunk_lnx64">
			<programs>
				<program ref="execute_container">
					<arguments>
						<argument>run_dimr.sh</argument>
						<argument>-m</argument>
						<argument>dimr_config.xml</argument>
					</arguments>
				</program>
			</programs>
			<location ref="cases" type="input">
				<from>.</from>				<!-- if "to" is not specified, "from" is used as target -->
			</location>
			<location ref="reference_results" type="reference">
				<from>lnx64</from>
			</location>
			<maxRunTime>6000.0</maxRunTime>
		</testCase>
		<testCase name="dimr_trunk_win64">
			<programs>
				<program ref="execute_container">
					<arguments>
						<argument>run_dimr.sh</argument>
						<argument>-m</argument>
						<argument>dimr_config.xml</argument>
					</arguments>
				</program>
			</programs>
			<location ref="cases" type="input">
				<from>.</from>				<!-- if "to" is not specified, "from" is used as target -->
			</location>
			<location ref="reference_results" type="reference">
				<from>win64</from>
			</location>
			<maxRunTime>14400.0</maxRunTime>
		</testCase>
		<testCase name="dflowfm_default">
			<programs>
				<program ref="dimr">
					<arguments>
						<argument>-m dimr.xml</argument>
					</arguments>
				</program>
			</programs>
			<location ref="cases" type="input">
				<!-- if "to" is not specified, "from" is used as target -->
				<from>.</from>
			</location>
			<location ref="local" type="check">
				<from>teamcity_artifacts/lnx64/bin</from>
			</location>
			<location ref="reference_results" type="reference">
				<from>win64</from>
			</location>
			<maxRunTime>3600.0</maxRunTime>
			<!-- seconds -->
		</testCase>
        <testCase name="container_postproc">
            <location ref="reference_results" type="reference">
                <from>win64</from>
            </location>
            <location ref="cases" type="input">
                <from>.</from>
            </location>
            <maxRunTime>60.0</maxRunTime>
        </testCase>
	</defaultTestCases>
	<xi:include href="../../include/dimr_smoke_test_cases.xml"/>
</deltaresTestbench_v3>
